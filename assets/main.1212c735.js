import{r as w,c as q,g as D,u as _,i as j,j as y,F as C,a as s,A as B,R as G,b as $}from"./useMeasure.f9b9459a.js";var R={exports:{}};(function(O,k){(function(S,m){O.exports=m(w.exports)})(q,function(M){return function(S){var m={};function d(i){if(m[i])return m[i].exports;var c=m[i]={i,l:!1,exports:{}};return S[i].call(c.exports,c,c.exports,d),c.l=!0,c.exports}return d.m=S,d.c=m,d.d=function(i,c,l){d.o(i,c)||Object.defineProperty(i,c,{enumerable:!0,get:l})},d.r=function(i){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},d.t=function(i,c){if(c&1&&(i=d(i)),c&8||c&4&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(d.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),c&2&&typeof i!="string")for(var b in i)d.d(l,b,function(x){return i[x]}.bind(null,b));return l},d.n=function(i){var c=i&&i.__esModule?function(){return i.default}:function(){return i};return d.d(c,"a",c),c},d.o=function(i,c){return Object.prototype.hasOwnProperty.call(i,c)},d.p="",d(d.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(S,m,d){d.r(m);var i=d("react"),c=function(){var h=function(a,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])},h(a,e)};return function(a,e){h(a,e);function t(){this.constructor=a}a.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),l=function(){return l=Object.assign||function(h){for(var a,e=1,t=arguments.length;e<t;e++){a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(h[n]=a[n])}return h},l.apply(this,arguments)},b=function(h,a){var e={};for(var t in h)Object.prototype.hasOwnProperty.call(h,t)&&a.indexOf(t)<0&&(e[t]=h[t]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(h);n<t.length;n++)a.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(h,t[n])&&(e[t[n]]=h[t[n]]);return e};(function(){typeof window!="undefined"&&(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(a){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,a,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function x(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var N=function(h){c(a,h);function a(e){var t=h.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return a.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!x()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},a.prototype.componentDidUpdate=function(e){var t=this.props;if(!x()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),u=e.minScreenshotWidth!==t.minScreenshotWidth,o=e.minScreenshotHeight!==t.minScreenshotHeight;(r||u||o)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())},a.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},a.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},a.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(a.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},a.prototype.getScreenshot=function(e){var t=this,n=t.state,r=t.props;if(!n.hasUserMedia)return null;var u=this.getCanvas(e);return u&&u.toDataURL(r.screenshotFormat,r.screenshotQuality)},a.prototype.getCanvas=function(e){var t=this,n=t.state,r=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var u=this.video.videoWidth,o=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var f=u/o;u=r.minScreenshotWidth||this.video.clientWidth,o=u/f,r.minScreenshotHeight&&o<r.minScreenshotHeight&&(o=r.minScreenshotHeight,u=o*f)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||u,this.canvas.height=(e==null?void 0:e.height)||o,this.ctx=this.canvas.getContext("2d")}var v=this,p=v.ctx,g=v.canvas;return p&&g&&(r.mirrored&&(p.translate(g.width,0),p.scale(-1,1)),p.imageSmoothingEnabled=r.imageSmoothing,p.drawImage(this.video,0,0,(e==null?void 0:e.width)||g.width,(e==null?void 0:e.height)||g.height),r.mirrored&&(p.scale(-1,1),p.translate(-g.width,0))),g},a.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(o,f){var v={video:typeof f!="undefined"?f:!0};t.audio&&(v.audio=typeof o!="undefined"?o:!0),e.requestUserMediaId++;var p=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(v).then(function(g){e.unmounted||p!==e.requestUserMediaId?a.stopMediaStream(g):e.handleUserMedia(null,g)}).catch(function(g){e.handleUserMedia(g)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var r=function(o){return{optional:[{sourceId:o}]}},u=function(o){var f=o.deviceId;return typeof f=="string"?f:Array.isArray(f)&&f.length>0?f[0]:typeof f=="object"&&f.ideal?f.ideal:null};MediaStreamTrack.getSources(function(o){var f=null,v=null;o.forEach(function(U){U.kind==="audio"?f=U.id:U.kind==="video"&&(v=U.id)});var p=u(t.audioConstraints);p&&(f=p);var g=u(t.videoConstraints);g&&(v=g),n(r(f),r(v))})}},a.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},a.prototype.render=function(){var e=this,t=this,n=t.state,r=t.props,u=r.audio;r.forceScreenshotSourceSize,r.onUserMedia,r.onUserMediaError,r.screenshotFormat,r.screenshotQuality,r.minScreenshotWidth,r.minScreenshotHeight,r.audioConstraints,r.videoConstraints,r.imageSmoothing;var o=r.mirrored,f=r.style,v=f===void 0?{}:f,p=r.children,g=b(r,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),U=o?l(l({},v),{transform:(v.transform||"")+" scaleX(-1)"}):v,H={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",l({autoPlay:!0,src:n.src,muted:!u,playsInline:!0,ref:function(L){e.video=L},style:U},g)),p&&p(H))},a.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},a}(i.Component);m.default=N},react:function(S,m){S.exports=M}}).default})})(R);var P=D(R.exports),A="/assets/pic-tl.6cfc85ae.svg",I="/assets/pic-tr.00db4771.svg",J="/assets/pic-bl.49e26862.svg",F="/assets/pic-br.cabd1206.svg",T="/assets/frame.4c0b7093.svg",Q="/assets/title.270303a9.svg",V="/assets/title-m.cbbbe27a.svg",W="/assets/dot-bl.e3f5e76e.svg",z="/assets/dot-tr.cd13e70b.svg",E="/assets/loading.f7b1362b.svg";const X=()=>y(C,{children:[s("img",{className:"block absolute left-0 top-0 bg-no-repeat bg-left-top origin-top-left scale-75 xl:scale-90 2xl:scale-100",src:A,style:{width:"164px",height:"164px"}}),s("img",{className:"block absolute right-0 top-0 bg-no-repeat bg-right-top origin-top-right scale-75 xl:scale-90 2xl:scale-100",src:z,style:{width:"259px",height:"259px"}}),s("img",{className:"block absolute right-[90px] top-[110px] bg-no-repeat bg-right-top origin-top-right scale-75 xl:scale-90 2xl:scale-100",src:I,style:{width:"147px",height:"147px"}}),s("img",{className:"block absolute left-0 bottom-0 bg-no-repeat bg-left-bottom origin-bottom-left scale-75 xl:scale-90 2xl:scale-100",src:W,style:{width:"259px",height:"259px"}}),s("img",{className:"block absolute left-[140px] bottom-[50px] bg-no-repeat bg-left-bottom origin-bottom-left scale-75 xl:scale-90 2xl:scale-100",src:J,style:{width:"112px",height:"112px"}}),s("img",{className:"block absolute right-0 bottom-0 bg-no-repeat bg-right-bottom origin-bottom-right scale-75 xl:scale-90 2xl:scale-100",src:F,style:{width:"164px",height:"164px"}})]}),K=()=>y(C,{children:[s("img",{className:"block absolute right-0 top-0 transform bg-no-repeat bg-right-top origin-top-right scale-[0.4]",src:z,style:{width:"259px",height:"259px"}}),s("img",{className:"block absolute left-0 bottom-0 bg-no-repeat bg-left-bottom origin-bottom-left  scale-[0.5]",src:W,style:{width:"259px",height:"259px"}}),s("img",{className:"block absolute bottom-[42px] left-0 bg-no-repeat bg-left-top origin-left scale-[0.42]",src:A,style:{width:"164px",height:"164px"}}),s("img",{className:"block absolute right-0 bottom-0 bg-no-repeat bg-right-bottom origin-bottom-right scale-[0.42]",src:F,style:{width:"164px",height:"164px"}}),s("img",{className:"block absolute bottom-[30px] left-[50%] bg-no-repeat bg-top",src:I,style:{width:"147px",height:"147px",transform:"translateX(-50%) scale(0.6)"}})]}),Y=()=>{const[O,{width:k,height:M}]=_(),[S,{width:m,height:d}]=_(),i=w.exports.useRef(null),c=w.exports.useRef(null),[l,b]=w.exports.useState("unfinished"),x=w.exports.useRef(!1),[N,h]=w.exports.useState("cam"),[a,e]=w.exports.useState(""),t=w.exports.useCallback(async()=>{var r;if(i.current&&!x.current){const u=i.current.getScreenshot();e(u),h("image"),b("checking"),x.current=!0;try{const o=await((r=j.exports.getAuthClient())==null?void 0:r.getCurrentUser());await fetch("https://7th.pingcap.net",{method:"POST",body:JSON.stringify({photo:u,name:(o==null?void 0:o.name)||"Unknown"}),headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer "+(o==null?void 0:o.token)})}),b("finished")}catch(o){console.error(o),b("unfinished")}finally{x.current=!1}}},[i]),n=w.exports.useCallback(async()=>{var r;if(c.current&&!x.current){const u=c.current.getScreenshot();e(u),h("image"),b("checking"),x.current=!0;try{const o=await((r=j.exports.getAuthClient())==null?void 0:r.getCurrentUser());await fetch("https://7th.pingcap.net",{method:"POST",body:JSON.stringify({photo:u,name:(o==null?void 0:o.name)||"Unknown"}),headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer "+(o==null?void 0:o.token)})}),b("finished")}catch(o){console.error(o),b("unfinished")}finally{x.current=!1}}},[c]);return y(C,{children:[y("div",{className:"h-full w-full min-h-[640px] relative hidden lg:flex",children:[s(X,{}),s("div",{className:"absolute inset-0 z-[100] flex items-center justify-center",children:y("div",{className:"w-full flex justify-evenly pr-28 pl-20",children:[s("div",{className:"bg-no-repeat bg-left origin-center scale-75 xl:scale-90 2xl:scale-100",style:{backgroundImage:`url(${Q})`,width:"367px",height:"481px"}}),y("div",{className:"flex flex-col items-center",children:[s("div",{className:"bg-no-repeat bg-right relative flex origin-center scale-75 xl:scale-90 2xl:scale-100",style:{backgroundImage:`url(${T})`,width:"700px",height:"474px",padding:"5.7143% 6.2857% 5.4286% 6.4286%"},children:s("div",{className:"flex-grow w-full bg-white overflow-hidden",ref:O,children:k&&M?N==="cam"?s(P,{ref:i,minScreenshotWidth:k,minScreenshotHeight:M,style:{width:k,height:M},screenshotFormat:"image/jpeg",videoConstraints:{height:M,width:k}}):s("img",{src:a,className:"block"}):s(C,{})})}),y("button",{className:`flex items-center mt-10 px-8 h-10 rounded-3xl transform bg-white text-vi-base text-lg font-semibold outline-none border-none cursor-pointer shadow-btn-white transition-all ${l==="checking"?"cursor-wait":l==="finished"?"shadow-none":"hover:shadow-btn-white-hover active:scale-90"}`,onClick:t,children:[l==="checking"&&s("div",{className:"bg-no-repeat h-5 w-5 mr-4 animate-spin",style:{backgroundImage:`url(${E})`}}),l==="finished"?"\u{1F389}  Checked In":"Check In"]})]})]})})]}),y("div",{className:"h-full w-full min-h-screen relative lg:hidden",children:[s(K,{}),y("div",{className:"absolute inset-0 z-[100] flex flex-col items-center px-6 py-12",children:[s("img",{src:V,className:"block mb-8"}),y("div",{className:"relative",children:[s("img",{src:T,className:"block"}),s("div",{className:"absolute inset-0 flex flex-col",style:{padding:"5.7143% 6.2857% 5.4286% 6.4286%"},children:s("div",{className:"flex-grow w-full bg-white overflow-hidden",ref:S,children:m&&d?N==="cam"?s(P,{ref:c,minScreenshotWidth:m,minScreenshotHeight:d,style:{minWidth:"100%",transform:"translateY(-20%)"},screenshotFormat:"image/jpeg",forceScreenshotSourceSize:!0}):s("img",{src:a,className:"block"}):s(C,{})})})]}),y("button",{className:`flex items-center mt-12 px-8 h-10 rounded-3xl transform bg-white text-vi-base text-lg font-semibold outline-none border-none cursor-pointer shadow-btn-white transition-all ${l==="checking"?"cursor-wait":l==="finished"?"shadow-none":"hover:shadow-btn-white-hover active:scale-90"}`,onClick:n,children:[l==="checking"&&s("div",{className:"bg-no-repeat h-5 w-5 mr-4 animate-spin",style:{backgroundImage:`url(${E})`}}),l==="finished"?"\u{1F389}  Checked In":"Check In"]})]})]})]})},Z=()=>s("div",{className:"h-full bg-vi-base lg:min-w-[1280px]",children:s(B,{children:s(Y,{})})});G.render(s($.StrictMode,{children:s(Z,{})}),document.getElementById("root"));
